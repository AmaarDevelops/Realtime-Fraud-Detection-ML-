<!Doctype html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Fraud Detection</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='style.css') }}"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    </head>
<body>

    <div class="container">
        <h1>Real Time Credit Card Fraud Detection</h1>
        <div class="form-section">
            <h2>Enter Transaction Details</h2>
            <form id="transaction-form">
                <p>Prove Values for All 29 features (Time , V1-V28,Amount).</p>
                <div class="input-grid">
                    <div class="input-group">
                    <label for="Time">Time:</label>
                    <input type="number" id="Time" name="Time" value="12345.00" step="any"/>
                </div>
                <div class="input-group">
                    <label for="Amount">Amount:</label>
                    <input type="number" id="Amount" name="Amount" value="100.0" step="any"/>
                </div>
                  <div class="input-group"><label for="V1">V1:</label><input type="number" id="V1" name="V1" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V2">V2:</label><input type="number" id="V2" name="V2" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V3">V3:</label><input type="number" id="V3" name="V3" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V4">V4:</label><input type="number" id="V4" name="V4" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V5">V5:</label><input type="number" id="V5" name="V5" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V6">V6:</label><input type="number" id="V6" name="V6" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V7">V7:</label><input type="number" id="V7" name="V7" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V8">V8:</label><input type="number" id="V8" name="V8" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V9">V9:</label><input type="number" id="V9" name="V9" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V10">V10:</label><input type="number" id="V10" name="V10" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V11">V11:</label><input type="number" id="V11" name="V11" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V12">V12:</label><input type="number" id="V12" name="V12" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V13">V13:</label><input type="number" id="V13" name="V13" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V14">V14:</label><input type="number" id="V14" name="V14" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V15">V15:</label><input type="number" id="V15" name="V15" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V16">V16:</label><input type="number" id="V16" name="V16" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V17">V17:</label><input type="number" id="V17" name="V17" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V18">V18:</label><input type="number" id="V18" name="V18" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V19">V19:</label><input type="number" id="V19" name="V19" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V20">V20:</label><input type="number" id="V20" name="V20" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V21">V21:</label><input type="number" id="V21" name="V21" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V22">V22:</label><input type="number" id="V22" name="V22" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V23">V23:</label><input type="number" id="V23" name="V23" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V24">V24:</label><input type="number" id="V24" name="V24" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V25">V25:</label><input type="number" id="V25" name="V25" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V26">V26:</label><input type="number" id="V26" name="V26" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V27">V27:</label><input type="number" id="V27" name="V27" value="0.0" step="any"></div>
                    <div class="input-group"><label for="V28">V28:</label><input type="number" id="V28" name="V28" value="0.0" step="any"></div>
                    </div>
                    <button type="submit">Predict Fraud</button>
            </form>
            <div>
                <h3>Quick Examples:</h3>
                <button type="button" onclick="loadExample('fraud1')">Load Fraud Example</button>
                <button type="button" onclick="loadExample('legit1')">Load Legitimate Example</button>
                <button type="button" onclick="clearForm()">Clear Form</button>
            </div>

        </div>
 

    <div class="results-section">
        <h2>Prediction Result:</h2>
        <div id="prediction-output" class="loading">Waiting for input.....</div>
    </div>

    </div>

    <script type="text/javascript">
        var socket = io.connect('http://' + document.domain + ":" + location.port)
        socket.on('connect',function(){
            console.log('Connected to Server')
        });

        socket.on('prediction_result',function(data){
            var OutputDiv = document.getElementById('prediction-output');
            OutputDiv.className = ""
            
            if (data.error) {
                OutputDiv.innerHTML = `<span class='error'>Error :${data.error}</span>`;
                OutputDiv.classList.add('error')           
            } else {
                var className = data.prediction === "Fraud" ? 'fraud' : 'not-fraud';
                OutputDiv.innerHTML = `
                <div class='result-item'>Status: <span class="${ className }">${data.prediction}</span></div>
                <div class='result-item'>Fraud Probability : ${data.fraud_probability.toFixed(4)}</div>
                `;
                OutputDiv.classList.add(className);
            }
        });

        document.getElementById('transaction-form').onsubmit = function(event){
            event.preventDefault();

            var formData = new FormData(event.target)
            var transactionData = {}

            for (let [key,value] of formData.entries()) {
                transactionData[key] = parseFloat(value) || 0.0
            }

            socket.emit('new_transaction',transactionData);
            document.getElementById('prediction-output').innerHTML = '<span class="loading">Processing..</span>';
            document.getElementById('prediction-output').className = 'loading'

        };

        const examples = {
            'fraud1': {
                'Time': 406.0, 'Amount': 0.0, 'V1': -2.3122265, 'V2': 1.9519927, 'V3': -1.6098507,
                'V4': 3.9979058, 'V5': -0.5221878, 'V6': -1.4265453, 'V7': -2.5373873,
                'V8': 1.3916572, 'V9': -2.7700892, 'V10': -2.7722721, 'V11': 2.5305602,
                'V12': -4.6895105, 'V13': -0.0381946, 'V14': -5.8675654, 'V15': -0.2037617,
                'V16': -0.513525, 'V17': -0.012243, 'V18': 0.3706121, 'V19': -0.9415668,
                'V20': -0.657051, 'V21': 0.7929489, 'V22': 0.419478, 'V23': 0.1269115,
                'V24': 0.991308, 'V25': 0.3754625, 'V26': -0.6062016, 'V27': -0.3932848,
                'V28': -0.710751
            },
            'legit1': {
                'Time': 100000.0, 'Amount': 50.0, 'V1': -0.3341764, 'V2': 0.6276235, 'V3': 1.4285802,
                'V4': -0.1983088, 'V5': 0.4194017, 'V6': -0.4357288, 'V7': 0.9254098,
                'V8': -0.0400194, 'V9': 0.5401306, 'V10': 0.1118606, 'V11': -0.093222,
                'V12': 0.0055272, 'V13': -0.0039308, 'V14': -0.0016766, 'V15': 0.0019552,
                'V16': 0.0041214, 'V17': -0.0028292, 'V18': 0.0020464, 'V19': 0.000305,
                'V20': -0.0002138, 'V21': -0.0000782, 'V22': -0.0001004, 'V23': 0.0000214,
                'V24': -0.0001844, 'V25': 0.0000057, 'V26': -0.000018, 'V27': 0.0000129,
                'V28': -0.000008
            },
        };

        function loadExample(exampleName){
            const example = examples[exampleName]
            if (example){
                for (const key in example){
                    const inputElement = document.getElementById(key);
                    if (inputElement){
                        inputElement.value = example[key];
                    }
                }
            }
            document.getElementById('prediction-output').innerHTML = '<span class="loading">Ready to predict!</span>';
            document.getElementById('prediction-output').className = 'loading';
            
        }

        function clearForm(){
            const form = document.getElementById('transaction-form')
            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '';
            });
            document.getElementById('prediction-output').innerHTML = '<span class="loading">Waiting for input.....</span>';
            document.getElementById('prediction-output').className = 'loading';
        }


        window.onload = function(){
            loadExample('legit1')
           
        };
    </script>
</body>

</html>